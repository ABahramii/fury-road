<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Fury Road</title>
    <script type="text/javascript" src="lib/three.js"></script>
    <script type="text/javascript" src="lib/OrbitControls.js"></script>
    <script type="text/javascript" src="lib/HDRCubeTextureLoader.js"></script>
    <script type="text/javascript" src="lib/OBJLoader.js"></script>
    <script type="text/javascript" src="lib/Tween.js"></script>
    <script type="text/javascript" src="lib/LegacyJSONLoader.js"></script>
    <script type="text/javascript" src="lib/GLTFLoader.js"></script>
    <script src="lib/DDSLoader.js"></script>
    <script src="lib/MTLLoader.js"></script>
    <script src="lib/OBJLoader.js"></script>
</head>
<body>
<div id="Web_Gl">

</div>

<script>
    let camera , renderer , scene ;
    let roadMesh , truck;
    let roadBlock = [1000] , block ;
    let gltfloader1 ,gltfloader2 ;
    let group ;
    init();
    animate();

    window.addEventListener('resize', onWindowResize, false);
    window.addEventListener('keydown',onDocumentKeyUp,false);

    function init() {
        // create scene
        scene = new THREE.Scene();

        //create cube box mapping
        let reflection = new THREE.CubeTextureLoader()
            .setPath('pic/')
            .load(['wall2.jpg', 'wall2.jpg', 'wall2.jpg', 'wall2.jpg', 'wall2.jpg', 'wall2.jpg']);
        reflection.format = THREE.RGBFormat;
        reflection.magFilter = THREE.NearestFilter ;
        reflection.minFilter = THREE.LinearFilter ;
        scene.background = reflection;

        // create camera
        camera = new THREE.PerspectiveCamera(50, window.innerWidth/window.innerHeight, 0.1, 100000);
        camera.position.set(0, 50, -200);
        camera.lookAt(scene.position);

        // create render
        renderer = new THREE.WebGLRenderer({ antialias : true });
        renderer.setClearColor('#fffffff');
        renderer.setSize(window.innerWidth,window.innerHeight);

        document.getElementById('Web_Gl').appendChild(renderer.domElement);

        // road
        let textureRoad = new THREE.TextureLoader().setPath('pic/').load('myRoad.png');

        textureRoad.repeat.set(1, 500);
        textureRoad.wrapS = THREE.RepeatWrapping;
        textureRoad.wrapT = THREE.RepeatWrapping;
        textureRoad.magFilter = THREE.NearestFilter;
        textureRoad.minFilter = THREE.LinearFilter;

        let road = new THREE.PlaneGeometry(300, 150000);
        let roadMaterial = new THREE.MeshBasicMaterial({color: 0xcccccc, side: THREE.DoubleSide, map: textureRoad});
        roadMesh = new THREE.Mesh(road, roadMaterial);
        roadMesh.rotateX(Math.PI / 2);
        roadMesh.position.y = -60;
        roadMesh.position.z = -300;
        scene.add(roadMesh);

        // insert car 3D model
        gltfloader1 = new THREE.GLTFLoader();
        gltfloader1.load('model/truck car/out.glb', function (gltf) {
            truck = gltf.scene;
            console.log(truck);
            truck.scale.set(55, 55, 55);
            truck.rotateY(Math.PI / 2);
            truck.position.set(0, -10, 0);
            scene.add(truck);
        });

        group = new THREE.Group();

        group = new THREE.Group();
        gltfloader2 = new THREE.GLTFLoader();
        gltfloader2.load('model/road block/road block.glb', function (gltf) {
            block = gltf.scene ;
            block.rotateY(Math.PI/2);
            block.scale.set(40,40,40);
            for( let i=0 ; i<10 ; i++ ){

                roadBlock[i] = block.clone();
                if(i%2==0)
                    roadBlock[i].position.set(95,-35,i*1000);
                else
                    roadBlock[i].position.set(-95,-35,i*1000);
                group.add(roadBlock[i]);

            }
            scene.add(group);
        });



        // add light
        let ambiLight= new THREE.AmbientLight("#fffffff", 1);
        scene.add(ambiLight);
    }

    function animate() {
        let t = (Date.now() / 1000) ;
        roadMesh.position.z -= 8 ;
        group.position.z -= 8 ;
        requestAnimationFrame(animate);
        renderer.render(scene,camera);
    }

    function onDocumentKeyUp(event) {

        if (event.keyCode === 37 ) {
            if(camera.position.x < -90 ){
                roadMesh.position.x = -89;
                camera.position.x = -89 ;
                group.position.x = -89;
            }
            camera.position.x -= 3;
            roadMesh.position.x -= 3;
            group.position.x -= 3;


        }

        if (event.keyCode === 39 ) {
            if(camera.position.x > 90 ){
                roadMesh.position.x = 89;
                camera.position.x = 89 ;
                group.position.x = 89 ;
            }
            camera.position.x += 3;
            roadMesh.position.x += 3;
            group.position.x += 3;
        }


    }


    function onWindowResize() {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
    }
</script>

</body>
</html>